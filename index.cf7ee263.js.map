{"mappings":"yRAAgBA,EAAQC,EAAwBC,GAC9C,OAAOC,MAAMC,UAAUC,QAAQC,KAAKL,EAAUC,0VCqBhD,IAAuBK,EACDC,mFArBtB,IAAIC,EAAU,GAoBdF,WAlBkBG,GAGhB,IAFA,IAAIC,EAAOC,OAAOD,KAAKD,GAEdG,EAAI,EAAGA,EAAIF,EAAKG,OAAQD,IAC/BJ,EAAQE,EAAKE,IAAMH,EAAMC,EAAKE,KAelCL,WAXiBO,GACf,IAAIC,EAAWP,EAAQM,GAEvB,GAAgB,MAAZC,EACF,MAAM,IAAIC,MAAM,oCAAsCF,GAGxD,OAAOC,MCnBTE,EAAA,SAAAC,SAA8CC,KAAKC,MAAM,0GCAvCC,GAAAA,EAAAA,EACZ,KAAJ,GAAA,OADgBA,EAAAA,EAEN,WAAV,GAAA,aAFgBA,EAAAA,EAGR,SAAR,GAAA,WAHgBA,EAAAA,EAIN,WAAV,GAAA,cAJgBA,IAAAA,EAAkB,aCEpCC,EAAiB,SAAUC,EAAWC,EAAQC,GAC5C,GAAID,IAAWE,KAAKC,SAASH,OAG3B,OAAOD,EAGP,IAAIK,EAASH,EAAQ,UAAYN,KAAKU,UAAUN,GAAa,IAAM,iBAAmBJ,KAAKU,UAAUN,GAAa,KAClH,OAAOO,IAAIC,gBAAgB,IAAIC,KAAK,CAACJ,GAAS,CAC5CK,KAAM,6BCVZ,IAAIC,EAAG,IAAAJ,IAAuBb,EAAA,SAAAkB,QAA6C,SAAOC,OAAAC,KAAAC,KAClFC,EAAiBjB,EAAUY,EAAIM,WAAYN,EAAIV,QAAQ,SCA1CiB,EAOXC,iBAAiBC,EAA2BC,EAAeC,GACzD,MAAMC,EAAYH,EAAOI,6BACzBC,KAAKC,OAAOC,YACV,CACEjB,KAAMZ,EAAmB8B,KACzBR,OAAQG,QACRF,SACAC,GAEF,CAAEC,IAINM,WAAWR,EAAeC,GACxBG,KAAKC,OAAOC,YAAY,CACtBjB,KAAMZ,EAAmBgC,iBACzBT,SACAC,IAIJS,SAASC,EAAoBC,EAAWC,GACtCT,KAAKC,OAAOC,YAAY,CACtBjB,KAAMZ,EAAmBqC,oBACzBH,IACAC,IACAC,IAIJE,WAAWJ,EAAoBC,EAAWC,GACxCT,KAAKC,OAAOC,YAAY,CACtBjB,KAAMZ,EAAmBuC,sBACzBL,IACAC,IACAC,kBAtCFT,KAAKC,OAAS,IAAIY,OAAMtB,ICH5B,MAAMuB,EAA2B,CAC/BC,SAAS,EACTC,SAAS,eAIT,MAAMC,EAAe,IAAIxB,EACnBE,EAASuB,SAASC,cAAc,mBAG7BC,IACPH,EAAab,WAAWiB,OAAOC,WAAYD,OAAOE,aAHpDN,EAAavB,iBAAiBC,EAAQ0B,OAAOC,WAAYD,OAAOE,aAKhEF,OAAOG,iBAAiB,SAAUJ,EAAYN,GAC9CM,IAEAzB,EAAO6B,iBACL,cACCC,IACCA,EAAMC,iBACNC,IACA5E,EAAK0E,EAAMG,gBAAgBC,IACzBZ,EAAaX,SAASuB,EAAMtB,WAAYsB,EAAMC,MAAOD,EAAME,aAG/D,GAEFpC,EAAO6B,iBACL,aACCC,IACCA,EAAMC,iBACN3E,EAAK0E,EAAMG,gBAAgBC,IACzBZ,EAAaN,WAAWkB,EAAMtB,WAAYsB,EAAMC,MAAOD,EAAME,aAGjE,GAGF,IAAIC,GAAc,WAwBTL,IACMT,SAASC,cAAc,cAC/Bc,UAAUC,IAAI,SAzBrBvC,EAAO6B,iBACL,aACAC,IACEE,IACAK,GAAc,EACdf,EAAaX,UAAS,EAAImB,EAAMK,MAAOL,EAAMM,SAE/CjB,GAEFnB,EAAO6B,iBACL,aACAC,IACMO,GACFf,EAAaN,YAAW,EAAIc,EAAMK,MAAOL,EAAMM,SAGnDjB,GAGFnB,EAAO6B,iBAAiB,WAAS,IAASQ,GAAc,GAAQlB,GAEhEnB,EAAO6B,iBAAiB,cAAY,IAASQ,GAAc,GAAQlB","sources":["src/utils.ts","node_modules/@parcel/runtime-js/lib/helpers/bundle-manifest.js","node_modules/@parcel/runtime-js/lib/runtime-3ccc749225e09b70.js","src/message.types.ts","node_modules/@parcel/runtime-js/lib/helpers/get-worker-url.js","node_modules/@parcel/runtime-js/lib/runtime-f83a48a4e80539b8.js","src/worker.client.ts","src/main.ts"],"sourcesContent":["export function iter<T>(iterable: ArrayLike<T>, callback: (element: T) => void) {\n  return Array.prototype.forEach.call(iterable, callback);\n}\n","\"use strict\";\n\nvar mapping = {};\n\nfunction register(pairs) {\n  var keys = Object.keys(pairs);\n\n  for (var i = 0; i < keys.length; i++) {\n    mapping[keys[i]] = pairs[keys[i]];\n  }\n}\n\nfunction resolve(id) {\n  var resolved = mapping[id];\n\n  if (resolved == null) {\n    throw new Error('Could not resolve bundle with id ' + id);\n  }\n\n  return resolved;\n}\n\nmodule.exports.register = register;\nmodule.exports.resolve = resolve;","require('./helpers/bundle-manifest').register(JSON.parse(\"{\\\"ggRJm\\\":\\\"index.cf7ee263.js\\\",\\\"88RgO\\\":\\\"worker.176310b6.js\\\"}\"));","export const enum WorkerMessageTypes {\n  Init,\n  UpdateSize,\n  AddShape,\n  CloneShape,\n}\n","\"use strict\";\n\nmodule.exports = function (workerUrl, origin, isESM) {\n  if (origin === self.location.origin) {\n    // If the worker bundle's url is on the same origin as the document,\n    // use the worker bundle's own url.\n    return workerUrl;\n  } else {\n    // Otherwise, create a blob URL which loads the worker bundle with `importScripts`.\n    var source = isESM ? 'import ' + JSON.stringify(workerUrl) + ';' : 'importScripts(' + JSON.stringify(workerUrl) + ');';\n    return URL.createObjectURL(new Blob([source], {\n      type: 'application/javascript'\n    }));\n  }\n};","let workerURL = require('./helpers/get-worker-url');\nlet url = new __parcel__URL__(require('./helpers/bundle-manifest').resolve(\"88RgO\"));\nmodule.exports = workerURL(url.toString(), url.origin, true);","import { WorkerMessageTypes } from './message.types';\n\nexport class WorkerClient {\n  private readonly worker: Worker;\n\n  constructor() {\n    this.worker = new Worker(new URL('./worker.ts', import.meta.url), {type: 'module'});\n  }\n\n  initializeCanvas(canvas: HTMLCanvasElement, width: number, height: number): void {\n    const offscreen = canvas.transferControlToOffscreen();\n    this.worker.postMessage(\n      {\n        type: WorkerMessageTypes.Init,\n        canvas: offscreen,\n        width,\n        height,\n      },\n      [(offscreen as unknown) as Transferable],\n    );\n  }\n\n  updateSize(width: number, height: number): void {\n    this.worker.postMessage({\n      type: WorkerMessageTypes.UpdateSize,\n      width,\n      height,\n    });\n  }\n\n  addShape(identifier: number, x: number, y: number): void {\n    this.worker.postMessage({\n      type: WorkerMessageTypes.AddShape,\n      identifier,\n      x,\n      y,\n    });\n  }\n\n  cloneShape(identifier: number, x: number, y: number): void {\n    this.worker.postMessage({\n      type: WorkerMessageTypes.CloneShape,\n      identifier,\n      x,\n      y,\n    });\n  }\n}\n","import { iter } from './utils';\nimport { WorkerClient } from './worker.client';\n\nconst PASSIVE_NO_CAPTURE_FLAGS = {\n  capture: false,\n  passive: true,\n};\n\n(function() {\n  const workerClient = new WorkerClient();\n  const canvas = document.querySelector('canvas') as HTMLCanvasElement;\n  workerClient.initializeCanvas(canvas, window.innerWidth, window.innerHeight);\n\n  function sizeCanvas() {\n    workerClient.updateSize(window.innerWidth, window.innerHeight);\n  }\n  window.addEventListener('resize', sizeCanvas, PASSIVE_NO_CAPTURE_FLAGS);\n  sizeCanvas();\n\n  canvas.addEventListener(\n    'touchstart',\n    (event: TouchEvent) => {\n      event.preventDefault();\n      removeInfo();\n      iter(event.changedTouches, touch => {\n        workerClient.addShape(touch.identifier, touch.pageX, touch.pageY);\n      });\n    },\n    false,\n  );\n  canvas.addEventListener(\n    'touchmove',\n    (event: TouchEvent) => {\n      event.preventDefault();\n      iter(event.changedTouches, touch => {\n        workerClient.cloneShape(touch.identifier, touch.pageX, touch.pageY);\n      });\n    },\n    false,\n  );\n\n  let isMouseDown = false;\n  canvas.addEventListener(\n    'mousedown',\n    event => {\n      removeInfo();\n      isMouseDown = true;\n      workerClient.addShape(-1, event.pageX, event.pageY);\n    },\n    PASSIVE_NO_CAPTURE_FLAGS,\n  );\n  canvas.addEventListener(\n    'mousemove',\n    event => {\n      if (isMouseDown) {\n        workerClient.cloneShape(-1, event.pageX, event.pageY);\n      }\n    },\n    PASSIVE_NO_CAPTURE_FLAGS,\n  );\n\n  canvas.addEventListener('mouseup', () => (isMouseDown = false), PASSIVE_NO_CAPTURE_FLAGS);\n\n  canvas.addEventListener('mouseleave', () => (isMouseDown = false), PASSIVE_NO_CAPTURE_FLAGS);\n\n  function removeInfo() {\n    const text = document.querySelector('.info-text') as HTMLElement;\n    text.classList.add('faded');\n  }\n})();\n"],"names":["$dee17ffc48c7a0f3$export$c0bf298a2e425654","iterable","callback","Array","prototype","forEach","call","$4528545fb5423ad1$export$6503ec6e8aabbaf","$4528545fb5423ad1$export$f7ad0328861e2f03","$4528545fb5423ad1$var$mapping","pairs","keys","Object","i","length","id","resolved","Error","parcelRequire","register","JSON","parse","$84ba6f0f860e352d$export$2f5eea4b9ec04e82","$26f4d335c26fb245$exports","workerUrl","origin","isESM","self","location","source","stringify","URL","createObjectURL","Blob","type","$e0b6a40129862097$var$url","resolve","import","meta","url","$e0b6a40129862097$exports","toString","$fdc6929203558a55$export$e4cd0dfd45d302cc","initializeCanvas","canvas","width","height","offscreen","transferControlToOffscreen","this","worker","postMessage","Init","updateSize","UpdateSize","addShape","identifier","x","y","AddShape","cloneShape","CloneShape","Worker","$c39ea02b55659438$var$PASSIVE_NO_CAPTURE_FLAGS","capture","passive","workerClient","document","querySelector","sizeCanvas","window","innerWidth","innerHeight","addEventListener","event","preventDefault","removeInfo","changedTouches","touch","pageX","pageY","isMouseDown","classList","add"],"version":3,"file":"index.cf7ee263.js.map"}